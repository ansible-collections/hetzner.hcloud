# Copyright: (c) 2025, Hetzner Cloud GmbH <info@hetzner-cloud.de>
# GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)
---
- name: Gather hcloud_storage_box_info
  hetzner.hcloud.storage_box_info:
  register: result
- name: Verify hcloud_storage_box_info
  ansible.builtin.assert:
    that:
      - result.hcloud_storage_box_info | list | count >= 1

- name: Gather hcloud_storage_box_info in check mode
  hetzner.hcloud.storage_box_info:
  check_mode: true
  register: result
- name: Verify hcloud_storage_box_info in check mode
  ansible.builtin.assert:
    that:
      - result.hcloud_storage_box_info | list | count >= 1

- name: Gather hcloud_storage_box_info with label
  hetzner.hcloud.storage_box_info:
    label_selector: key={{ hcloud_ns }}
  register: result
- name: Verify hcloud_storage_box_info
  ansible.builtin.assert:
    that:
      - result.hcloud_storage_box_info | list | count == 1

- name: Gather hcloud_storage_box_info with correct id
  hetzner.hcloud.storage_box_info:
    id: "{{ test_storage_box.hcloud_storage_box.id }}"
  register: result
- name: Verify hcloud_storage_box_info with correct id
  ansible.builtin.assert:
    that:
      - result.hcloud_storage_box_info | list | count == 1
      - result.hcloud_storage_box_info[0].id == test_storage_box.hcloud_storage_box.id
      - result.hcloud_storage_box_info[0].name == hcloud_storage_box_name
      - result.hcloud_storage_box_info[0].storage_box_type == hcloud_storage_box_type_name
      - result.hcloud_storage_box_info[0].location == hcloud_location_name
      - result.hcloud_storage_box_info[0].labels.key == hcloud_ns
      - result.hcloud_storage_box_info[0].delete_protection == false
      - result.hcloud_storage_box_info[0].access_settings.reachable_externally == false
      - result.hcloud_storage_box_info[0].access_settings.samba_enabled == false
      - result.hcloud_storage_box_info[0].access_settings.ssh_enabled == true
      - result.hcloud_storage_box_info[0].access_settings.webdav_enabled == false
      - result.hcloud_storage_box_info[0].access_settings.zfs_enabled == false
      - result.hcloud_storage_box_info[0].status == "active"
      - result.hcloud_storage_box_info[0].server is not none
      - result.hcloud_storage_box_info[0].system is not none
      - result.hcloud_storage_box_info[0].username is not none
      - result.hcloud_storage_box_info[0].stats.size >= 0
      - result.hcloud_storage_box_info[0].stats.size_data >= 0
      - result.hcloud_storage_box_info[0].stats.size_snapshots >= 0

- name: Gather hcloud_storage_box_info with wrong id
  hetzner.hcloud.storage_box_info:
    id: "{{ test_storage_box.hcloud_storage_box.id }}4321"
  ignore_errors: true
  register: result
- name: Verify hcloud_storage_box_info with wrong id
  ansible.builtin.assert:
    that:
      - result is failed

- name: Gather hcloud_storage_box_info with correct name
  hetzner.hcloud.storage_box_info:
    name: "{{ hcloud_storage_box_name }}"
  register: result
- name: Verify hcloud_storage_box_info with correct name
  ansible.builtin.assert:
    that:
      - result.hcloud_storage_box_info | list | count == 1

- name: Gather hcloud_storage_box_info with wrong name
  hetzner.hcloud.storage_box_info:
    name: "{{ hcloud_storage_box_name }}-invalid"
  register: result
- name: Verify hcloud_storage_box_info with wrong name
  ansible.builtin.assert:
    that:
      - result.hcloud_storage_box_info | list | count == 0
